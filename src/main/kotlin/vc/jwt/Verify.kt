package vc.jwt


import id.walt.did.dids.DidService
import id.walt.policies.Verifier
import id.walt.policies.models.PolicyRequest
import id.walt.policies.policies.JwtSignaturePolicy

suspend fun main() {
    verifyJwtVc()
}

suspend fun verifyJwtVc() {
    DidService.minimalInit()

    val signedJwtVc = "eyJraWQiOiJYdUhGRWJ3UnIwQldma3l0NEF6Z3FQMEIxeDdiVTFZVDRPbXdYVzc1M0VVIiwiYWxnIjoiRWREU0EifQ.eyJpc3MiOiJkaWQ6a2V5OnptWWc5YmdLbVJpQ3FUVGQ5TUExdWZWRTl0ZnpVcHR3UXA0R01SeHB0WHF1Sld3NFVqNWRGYTQzWXpZWXJLZ3RIc3hNcTUyVWpMZ0VaczVZd1F4bUZ5SFp6RHZ5d0VFNzhGZU5XVXRKMU1wemJnQ0ZuIiwic3ViIjoiZGlkOmtleTp6NE1YajF3QnppOWpVc3R5UENYWWhhaGFVNXFpYjZxUjZyQ2ZHUVdXR2RKTFh4NDlMS3pQbUVOYWQxcUpLcFBTcEs2NUQ2U3dTRXdmZjRTUThqUDh4MUxFVGNCbm4zRlVCOGJvODFzMzZCRkc2R0w3d0tKc3hMNDF2dWpGWGFXMkt1Y1BlUERRNU5pNUx1YUxwZXdKdzU1R0VDYlhpQ2VoNlFWRHdmOVFSZWVoZWo2Rk5heEZlb01CcVI1QTNEUnRIUGI0Nlh2eW5nVXI2SndHOFAzeTJYVFA3aVFSWndOZENoNTl5VFY2TGZjaUptZXlHUlNrNGZDUW9uNHdCMmVNM2t3VHR5RUE5QUNSR2s1V1JkbU1LZUFzZWFXQUZNUVM5NE1MTXZOaVhzcUJXZ3NMODdxRmViQjN1Vm43VmVYVkhGZlZUYVRXMTJqeTRGWmNSVGZSUE1IYWg1aEtpMXZzenBUTmM3N1dVN3RjYmdycWVKZ2tHIiwidmMiOnsiQGNvbnRleHQiOlsiaHR0cHM6Ly93d3cudzMub3JnLzIwMTgvY3JlZGVudGlhbHMvdjEiLCJodHRwczovL3B1cmwuaW1zZ2xvYmFsLm9yZy9zcGVjL29iL3YzcDAvY29udGV4dC0zLjAuMi5qc29uIl0sInR5cGUiOlsiVmVyaWZpYWJsZUNyZWRlbnRpYWwiLCJPcGVuQmFkZ2VDcmVkZW50aWFsIl0sImlkIjoidXJuOnV1aWQ6NDE3N2UwNDgtOWE0YS00NzRlLTlkYzYtYWVkNGU2MWE2NDM5IiwibmFtZSI6IkpGRiB4IHZjLWVkdSBQbHVnRmVzdCAzIEludGVyb3BlcmFiaWxpdHkiLCJpc3N1ZXIiOiJkaWQ6a2V5OnptWWc5YmdLbVJpQ3FUVGQ5TUExdWZWRTl0ZnpVcHR3UXA0R01SeHB0WHF1Sld3NFVqNWRGYTQzWXpZWXJLZ3RIc3hNcTUyVWpMZ0VaczVZd1F4bUZ5SFp6RHZ5d0VFNzhGZU5XVXRKMU1wemJnQ0ZuIiwiaXNzdWFuY2VEYXRlIjoiMjAyMy0wOC0wMlQwODowMzoxM1oiLCJjcmVkZW50aWFsU3ViamVjdCI6eyJ0eXBlIjpbIkFjaGlldmVtZW50U3ViamVjdCJdLCJpZCI6ImRpZDprZXk6ejRNWGoxd0J6aTlqVXN0eVBDWFloYWhhVTVxaWI2cVI2ckNmR1FXV0dkSkxYeDQ5TEt6UG1FTmFkMXFKS3BQU3BLNjVENlN3U0V3ZmY0U1E4alA4eDFMRVRjQm5uM0ZVQjhibzgxczM2QkZHNkdMN3dLSnN4TDQxdnVqRlhhVzJLdWNQZVBEUTVOaTVMdWFMcGV3Snc1NUdFQ2JYaUNlaDZRVkR3ZjlRUmVlaGVqNkZOYXhGZW9NQnFSNUEzRFJ0SFBiNDZYdnluZ1VyNkp3RzhQM3kyWFRQN2lRUlp3TmRDaDU5eVRWNkxmY2lKbWV5R1JTazRmQ1FvbjR3QjJlTTNrd1R0eUVBOUFDUkdrNVdSZG1NS2VBc2VhV0FGTVFTOTRNTE12TmlYc3FCV2dzTDg3cUZlYkIzdVZuN1ZlWFZIRmZWVGFUVzEyank0RlpjUlRmUlBNSGFoNWhLaTF2c3pwVE5jNzdXVTd0Y2JncnFlSmdrRyIsImFjaGlldmVtZW50Ijp7ImlkIjoidXJuOnV1aWQ6YWMyNTRiZDUtOGZhZC00YmIxLTlkMjktZWZkOTM4NTM2OTI2IiwidHlwZSI6WyJBY2hpZXZlbWVudCJdLCJuYW1lIjoiSkZGIHggdmMtZWR1IFBsdWdGZXN0IDMgSW50ZXJvcGVyYWJpbGl0eSIsImRlc2NyaXB0aW9uIjoiVGhpcyB3YWxsZXQgc3VwcG9ydHMgdGhlIHVzZSBvZiBXM0MgVmVyaWZpYWJsZSBDcmVkZW50aWFscyBhbmQgaGFzIGRlbW9uc3RyYXRlZCBpbnRlcm9wZXJhYmlsaXR5IGR1cmluZyB0aGUgcHJlc2VudGF0aW9uIHJlcXVlc3Qgd29ya2Zsb3cgZHVyaW5nIEpGRiB4IFZDLUVEVSBQbHVnRmVzdCAzLiIsImNyaXRlcmlhIjp7InR5cGUiOiJDcml0ZXJpYSIsIm5hcnJhdGl2ZSI6IldhbGxldCBzb2x1dGlvbnMgcHJvdmlkZXJzIGVhcm5lZCB0aGlzIGJhZGdlIGJ5IGRlbW9uc3RyYXRpbmcgaW50ZXJvcGVyYWJpbGl0eSBkdXJpbmcgdGhlIHByZXNlbnRhdGlvbiByZXF1ZXN0IHdvcmtmbG93LiBUaGlzIGluY2x1ZGVzIHN1Y2Nlc3NmdWxseSByZWNlaXZpbmcgYSBwcmVzZW50YXRpb24gcmVxdWVzdCwgYWxsb3dpbmcgdGhlIGhvbGRlciB0byBzZWxlY3QgYXQgbGVhc3QgdHdvIHR5cGVzIG9mIHZlcmlmaWFibGUgY3JlZGVudGlhbHMgdG8gY3JlYXRlIGEgdmVyaWZpYWJsZSBwcmVzZW50YXRpb24sIHJldHVybmluZyB0aGUgcHJlc2VudGF0aW9uIHRvIHRoZSByZXF1ZXN0b3IsIGFuZCBwYXNzaW5nIHZlcmlmaWNhdGlvbiBvZiB0aGUgcHJlc2VudGF0aW9uIGFuZCB0aGUgaW5jbHVkZWQgY3JlZGVudGlhbHMuIn0sImltYWdlIjp7ImlkIjoiaHR0cHM6Ly93M2MtY2NnLmdpdGh1Yi5pby92Yy1lZC9wbHVnZmVzdC0zLTIwMjMvaW1hZ2VzL0pGRi1WQy1FRFUtUExVR0ZFU1QzLWJhZGdlLWltYWdlLnBuZyIsInR5cGUiOiJJbWFnZSJ9fX19fQ.RLQ-UNhak_11RN25yT_nU9pcCd2hGa0sJ1jXPCkGGbdNDWRdr4NVz8f1ss0Gor-_eMkg39lmJvYmetB1WnxECg"
    println("Verify JWT VC: $signedJwtVc")

    val jwtVerificationResults = Verifier.verifyCredential(
        signedJwtVc,
        listOf(
            PolicyRequest(JwtSignaturePolicy())
        )
    )
    jwtVerificationResults.forEach { verification ->
        println("[${verification.request.policy.name}] -> Success=${verification.isSuccess()}, Result=${verification.result}")
    }
}
