package vc.sdjwt

import id.walt.did.dids.DidService
import id.walt.policies.Verifier
import id.walt.policies.models.PolicyRequest
import id.walt.policies.policies.JwtSignaturePolicy

suspend fun main() {
    verifySdJwtVc()
}

suspend fun verifySdJwtVc() {
    DidService.minimalInit()

    val signedSdJwtVc = "eyJraWQiOiJkaWQ6a2V5OnptWWc5YmdLbVJpQ3FUVGQ5TUExdWZWRTl0ZnpVcHR3UXA0R01SeHB0WHF1Sld3NFVqNWJiV0FMalE3N29yRnR1TlZBM3AySllwZmpRMVA1SkUxQ0RLOGdYSjY5aEpnR1JTNUdyTTRFTnhLWHZVSzhRIiwiYWxnIjoiRWREU0EifQ.eyJAY29udGV4dCI6WyJodHRwczovL3d3dy53My5vcmcvMjAxOC9jcmVkZW50aWFscy92MSIsImh0dHBzOi8vcHVybC5pbXNnbG9iYWwub3JnL3NwZWMvb2IvdjNwMC9jb250ZXh0LTMuMC4yLmpzb24iXSwidHlwZSI6WyJWZXJpZmlhYmxlQ3JlZGVudGlhbCIsIk9wZW5CYWRnZUNyZWRlbnRpYWwiXSwiaWQiOiJ1cm46dXVpZDo0MTc3ZTA0OC05YTRhLTQ3NGUtOWRjNi1hZWQ0ZTYxYTY0MzkiLCJpc3N1ZXIiOiJkaWQ6a2V5OnptWWc5YmdLbVJpQ3FUVGQ5TUExdWZWRTl0ZnpVcHR3UXA0R01SeHB0WHF1Sld3NFVqNWJiV0FMalE3N29yRnR1TlZBM3AySllwZmpRMVA1SkUxQ0RLOGdYSjY5aEpnR1JTNUdyTTRFTnhLWHZVSzhRIiwiaXNzdWFuY2VEYXRlIjoiMjAyMy0wOC0wMlQwODowMzoxM1oiLCJjcmVkZW50aWFsU3ViamVjdCI6eyJ0eXBlIjpbIkFjaGlldmVtZW50U3ViamVjdCJdLCJpZCI6ImRpZDprZXk6ejRNWGoxd0J6aTlqVXN0eVBucFZ4cmJhcXpmOWFLaUxCN2tGZjNSd2Zjd3IxNEFuN2ZNV1B0emRFTUpvS1BOb2J1Vmg5czdrV25zV2hURGZZakdTV3N5ZUxTWnA2MUJLYVpwWEd5V015REJRRFFmVjZWRFpwNTQzaDhhZjdoZ1B2cHJuV2szaW9LTk14WGZEWU5SNVZ6bUpQd3Q0N0tvR250R2JxWk1zVnptUUwxZGVFR1lwTU5vRTdGNDVLbUc3RXVuTE04YTlFNE5xdmtheGRUSmVxUUFzdGJHdXZRRVF5YnM3NkxaWE44aEVNemoxa0E4S3c5YTY4dHg0d1M4UER1OGM3c2s5SjFWZ1RTVnBGSkdHOWNMYW91N1I0ZWQ2N0hydFg0VnhCSjl4OVA4Vkp4RWl0ZEd3VmUyR3VXWXByZVBqaThXNnlwVFpRTUhHV2tvM3JIS3FBRUQybnFXYXlTcGhNYXZXWTdFMW1VMVNlYWJXRyIsImFjaGlldmVtZW50Ijp7ImlkIjoidXJuOnV1aWQ6YWMyNTRiZDUtOGZhZC00YmIxLTlkMjktZWZkOTM4NTM2OTI2IiwidHlwZSI6WyJBY2hpZXZlbWVudCJdLCJuYW1lIjoiSkZGIHggdmMtZWR1IFBsdWdGZXN0IDMgSW50ZXJvcGVyYWJpbGl0eSIsImRlc2NyaXB0aW9uIjoiVGhpcyB3YWxsZXQgc3VwcG9ydHMgdGhlIHVzZSBvZiBXM0MgVmVyaWZpYWJsZSBDcmVkZW50aWFscyBhbmQgaGFzIGRlbW9uc3RyYXRlZCBpbnRlcm9wZXJhYmlsaXR5IGR1cmluZyB0aGUgcHJlc2VudGF0aW9uIHJlcXVlc3Qgd29ya2Zsb3cgZHVyaW5nIEpGRiB4IFZDLUVEVSBQbHVnRmVzdCAzLiIsImNyaXRlcmlhIjp7InR5cGUiOiJDcml0ZXJpYSIsIm5hcnJhdGl2ZSI6IldhbGxldCBzb2x1dGlvbnMgcHJvdmlkZXJzIGVhcm5lZCB0aGlzIGJhZGdlIGJ5IGRlbW9uc3RyYXRpbmcgaW50ZXJvcGVyYWJpbGl0eSBkdXJpbmcgdGhlIHByZXNlbnRhdGlvbiByZXF1ZXN0IHdvcmtmbG93LiBUaGlzIGluY2x1ZGVzIHN1Y2Nlc3NmdWxseSByZWNlaXZpbmcgYSBwcmVzZW50YXRpb24gcmVxdWVzdCwgYWxsb3dpbmcgdGhlIGhvbGRlciB0byBzZWxlY3QgYXQgbGVhc3QgdHdvIHR5cGVzIG9mIHZlcmlmaWFibGUgY3JlZGVudGlhbHMgdG8gY3JlYXRlIGEgdmVyaWZpYWJsZSBwcmVzZW50YXRpb24sIHJldHVybmluZyB0aGUgcHJlc2VudGF0aW9uIHRvIHRoZSByZXF1ZXN0b3IsIGFuZCBwYXNzaW5nIHZlcmlmaWNhdGlvbiBvZiB0aGUgcHJlc2VudGF0aW9uIGFuZCB0aGUgaW5jbHVkZWQgY3JlZGVudGlhbHMuIn0sImltYWdlIjp7ImlkIjoiaHR0cHM6Ly93M2MtY2NnLmdpdGh1Yi5pby92Yy1lZC9wbHVnZmVzdC0zLTIwMjMvaW1hZ2VzL0pGRi1WQy1FRFUtUExVR0ZFU1QzLWJhZGdlLWltYWdlLnBuZyIsInR5cGUiOiJJbWFnZSJ9fX0sIl9zZCI6WyJRd2xDTjJ4enBfbTRfTXRRV01oOHN2aFdOUEdkR012NHl5dHVkQ1R5SnlVIiwiNm1ITjc5NEFkTnRzZWYyWnZTWXdVZHFNUHhSTGd1b25QdjFyT1ZhaWkxZyJdfQ.k1QvUuB-6b-U2FH5gAVg15B45NqMScU-o0UxdX6fnLiSjyFt5lGYs6ncYfmrjvOqi8M1mrSCUmG9OjfpJGmOCA~WyJRanh6emRfcmRRbVlPQU1sUXNwUnN3PT0iLCJuYW1lIiwiSkZGIHggdmMtZWR1IFBsdWdGZXN0IDMgSW50ZXJvcGVyYWJpbGl0eSJd"
    println("Verify SD-JWT VC: $signedSdJwtVc")

    val sdJwtVerificationResults = Verifier.verifyCredential(
        signedSdJwtVc,
        listOf(
            PolicyRequest(JwtSignaturePolicy())
        )
    )
    sdJwtVerificationResults.forEach { verification ->
        println("[${verification.request.policy.name}] -> Success=${verification.isSuccess()}, Result=${verification.result}")
    }
}

